<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Step Size Selection · FiniteDiff.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/FiniteDiff/stable/epsilons/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="FiniteDiff.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">FiniteDiff.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../derivatives/">Derivatives</a></li><li><a class="tocitem" href="../gradients/">Gradients</a></li><li><a class="tocitem" href="../jacobians/">Jacobians</a></li><li><a class="tocitem" href="../hessians/">Hessians</a></li><li><a class="tocitem" href="../jvp/">Jacobian-Vector Products</a></li><li class="is-active"><a class="tocitem" href>Step Size Selection</a><ul class="internal"><li><a class="tocitem" href="#Theory"><span>Theory</span></a></li><li><a class="tocitem" href="#Adaptive-Step-Sizing"><span>Adaptive Step Sizing</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Special-Cases"><span>Special Cases</span></a></li><li><a class="tocitem" href="#Practical-Considerations"><span>Practical Considerations</span></a></li></ul></li><li><a class="tocitem" href="../utilities/">Internal Utilities</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Step Size Selection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Step Size Selection</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiff/FiniteDiff.jl/blob/master/docs/src/epsilons.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Step-Size-Selection-(Epsilons)"><a class="docs-heading-anchor" href="#Step-Size-Selection-(Epsilons)">Step Size Selection (Epsilons)</a><a id="Step-Size-Selection-(Epsilons)-1"></a><a class="docs-heading-anchor-permalink" href="#Step-Size-Selection-(Epsilons)" title="Permalink"></a></h1><p>Functions and theory for computing optimal step sizes in finite difference approximations.</p><h2 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h2><p>The choice of step size (epsilon) in finite difference methods is critical for accuracy. Too large a step leads to truncation error, while too small a step leads to round-off error. The optimal step size balances these two sources of error.</p><h3 id="Error-Analysis"><a class="docs-heading-anchor" href="#Error-Analysis">Error Analysis</a><a id="Error-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Error-Analysis" title="Permalink"></a></h3><p>For a function <code>f</code> with bounded derivatives, the total error in finite difference approximations consists of:</p><ol><li><p><strong>Truncation Error</strong>: Comes from the finite difference approximation itself</p><ul><li>Forward differences: <code>O(h)</code> where <code>h</code> is the step size</li><li>Central differences: <code>O(h²)</code></li><li>Hessian central differences: <code>O(h²)</code> for second derivatives</li></ul></li><li><p><strong>Round-off Error</strong>: Comes from floating-point arithmetic</p><ul><li>Forward differences: <code>O(eps/h)</code> where <code>eps</code> is machine epsilon</li><li>Central differences: <code>O(eps/h)</code></li></ul></li></ol><h3 id="Optimal-Step-Sizes"><a class="docs-heading-anchor" href="#Optimal-Step-Sizes">Optimal Step Sizes</a><a id="Optimal-Step-Sizes-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-Step-Sizes" title="Permalink"></a></h3><p>Minimizing the total error <code>truncation + round-off</code> gives optimal step sizes:</p><ul><li><strong>Forward differences</strong>: <code>h* = sqrt(eps)</code> - balances <code>O(h)</code> truncation with <code>O(eps/h)</code> round-off</li><li><strong>Central differences</strong>: <code>h* = eps^(1/3)</code> - balances <code>O(h²)</code> truncation with <code>O(eps/h)</code> round-off</li><li><strong>Hessian central</strong>: <code>h* = eps^(1/4)</code> - balances <code>O(h²)</code> truncation for mixed derivatives</li><li><strong>Complex step</strong>: <code>h* = eps</code> - no subtractive cancellation, only limited by machine precision</li></ul><h2 id="Adaptive-Step-Sizing"><a class="docs-heading-anchor" href="#Adaptive-Step-Sizing">Adaptive Step Sizing</a><a id="Adaptive-Step-Sizing-1"></a><a class="docs-heading-anchor-permalink" href="#Adaptive-Step-Sizing" title="Permalink"></a></h2><p>The step size computation uses both relative and absolute components:</p><pre><code class="language-julia hljs">epsilon = max(relstep * abs(x), absstep) * dir</code></pre><p>This ensures:</p><ul><li><strong>Large values</strong>: Use relative step <code>relstep * |x|</code> for scale-invariant accuracy</li><li><strong>Small values</strong>: Use absolute step <code>absstep</code> to avoid underflow</li><li><strong>Direction</strong>: Multiply by <code>dir</code> (±1) for forward differences</li></ul><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><p>The step size computation is handled by internal functions:</p><ul><li><strong><code>compute_epsilon(fdtype, x, relstep, absstep, dir)</code></strong>: Computes the actual step size for a given finite difference method and input value</li><li><strong><code>default_relstep(fdtype, T)</code></strong>: Returns the optimal relative step size for a given method and numeric type</li></ul><p>These functions are called automatically by all finite difference routines, but understanding their behavior can help with custom implementations or debugging numerical issues.</p><h2 id="Special-Cases"><a class="docs-heading-anchor" href="#Special-Cases">Special Cases</a><a id="Special-Cases-1"></a><a class="docs-heading-anchor-permalink" href="#Special-Cases" title="Permalink"></a></h2><h3 id="Complex-Step-Differentiation"><a class="docs-heading-anchor" href="#Complex-Step-Differentiation">Complex Step Differentiation</a><a id="Complex-Step-Differentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Complex-Step-Differentiation" title="Permalink"></a></h3><p>For complex step differentiation, the step size is simply machine epsilon since this method avoids subtractive cancellation entirely:</p><p>⚠️ <strong>Important</strong>: The function <code>f</code> must be complex analytic when the input is complex!</p><h3 id="Sparse-Jacobians"><a class="docs-heading-anchor" href="#Sparse-Jacobians">Sparse Jacobians</a><a id="Sparse-Jacobians-1"></a><a class="docs-heading-anchor-permalink" href="#Sparse-Jacobians" title="Permalink"></a></h3><p>When computing sparse Jacobians with graph coloring, the step size is computed based on the norm of the perturbation vector to ensure balanced accuracy across all columns in the same color group.</p><h2 id="Practical-Considerations"><a class="docs-heading-anchor" href="#Practical-Considerations">Practical Considerations</a><a id="Practical-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Practical-Considerations" title="Permalink"></a></h2><ul><li><strong>Default step sizes</strong> are optimal for most smooth functions</li><li><strong>Custom step sizes</strong> may be needed for functions with unusual scaling or near-discontinuities</li><li><strong>Relative steps</strong> should scale with the magnitude of the input</li><li><strong>Absolute steps</strong> provide a fallback for inputs near zero</li><li><strong>Direction parameter</strong> allows for one-sided differences when needed (e.g., at domain boundaries)</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../jvp/">« Jacobian-Vector Products</a><a class="docs-footer-nextpage" href="../utilities/">Internal Utilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 16 August 2025 09:38">Saturday 16 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
